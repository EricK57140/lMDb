<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="utf-8" />
    <title>TP JQuery</title>
    <link rel="stylesheet" href="IMDb.css" />
</head>

</head>

<body>
    <div class="flex">
        <div class="slideshow">
            <ul>
                <li><img src="film1.JPG" /></li>
                <li><img src="film2.JPG" /></li>
                <li><img src="film3.JPG" /></li>
            </ul>
        </div>

        <div class="menu">
            <div class="recherche">
                <input type="search" id="motCle">
                <button class="btSearch"
                    onclick="rechercheFilm(document.getElementById('motCle').value)">Recherche</button>
            </div>
            <button onclick="proprietesFilm(ref, 1)">Description</button>
            <button onClick="proprietesFilm(ref, 2)">Synopsis</button>
            <button onClick="proprietesFilm(ref, 3)">Pas Click !</button>
        </div>
        <div class="container">
            <div id="vignette"></div>
            <div id="affiche"></div>
            <div id="synopsis"></div>
        </div>
        <div id="bandeau">
            <div id="similaires"></div>
        </div>
    </div>

</body>

</html>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

<script>

    // on crée le carrousel
    $(function () {
        setInterval(function () {
            $(".slideshow ul").animate({ marginLeft: -583 }, 1500, function () {
                $(this).css({ marginLeft: 0 }).find("li:last").after($(this).find("li:first"));
            })
        }, 3500);
    });

    // on définit les variables
    let boutonVert = false;
    let existeFiche = false;
    let existeSynopsis = false;
    let existeBandeau = false;
    let ref = "";

    //let apiKey = "k_hgwzc1fp";
    let apiKey = "k_mc792s9t";

    // on recherche un film à partir d'un mot-clé
    function rechercheFilm(keyword) {

        ref = "";

        let requete = 'https://imdb-api.com/fr/API/SearchMovie/' + apiKey + '/' + keyword;
        appelAPI(requete, 0);

        return;
    }

    // on va rechercher les informations du film
    function proprietesFilm(id, num) {

        if (id == "") { return }
        boutonVert = true;

        requete = 'https://imdb-api.com/fr/API/Title/' + apiKey + '/' + id;
        appelAPI(requete, num);

        boutonVert = false;

        return;
    }

    // on prépare une requête AJAX pour contacter l'API
    function appelAPI(url, num) {

        // on définit les paramètres d'accès à l'API
        var settings = {
            "url": url,
            "method": "GET",
            "timeout": 0,
        }

        console.log(url);

        // on lance la requête AJAX
        $.ajax(settings).done(function (response) {

            // on sélectionne la fonction idoine
            if (ref != "") {
                switch (num) {
                    case 1:
                        creationFiche(response);
                        break;
                    case 2:
                        creationSynopsis(response);
                        break;
                    case 3:
                        creationBandeau(response);
                        break;
                }
                return;
            }

            // on récupère l'identifiant du film
            if (num == 0 && ref == "") {
                for (const element of response.results) {
                    if (ref == "") { ref = element.id }
                }
            }
        });
        return;
    }

    // on parse la réponse et on modifie le DOM
    function creationBandeau(reponse) {

        // on récupère les images des films
        let x = 0;
        let picture = [];
        for (const element of reponse.similars) {
            if (x < 3) {
                picture[x] = element.image;
            }
            x++;
        }

        // on supprime l'ancien contenu
        if (existeBandeau) {
            var element = document.getElementById("bandeau");
            while (element.firstChild) {
                element.removeChild(element.firstChild);
            }
            // existeBandeau = false;
        }

        // on ajoute le contenu dans le DOM
        let bloc3 = document.getElementById("bandeau");

        let balise4 = document.createElement("img");
        balise4.src = picture[0];
        bloc3.appendChild(balise4);

        let balise5 = document.createElement("img");
        balise5.src = picture[1];
        bloc3.appendChild(balise5);

        let balise6 = document.createElement("img");
        balise6.src = picture[2];
        bloc3.appendChild(balise6);

        existeBandeau = true;
        return;
    }

    // on parse la réponse et on modifie le DOM
    function creationSynopsis(reponse) {

        // on supprime l'ancien contenu
        if (existeSynopsis) {
            var element = document.getElementById("synopsis");
            while (element.firstChild) {
                element.removeChild(element.firstChild);
            }
            // existeSynopsis = false;
        }

        // on ajoute le contenu dans le DOM
        let bloc2 = document.getElementById("synopsis");

        let balise2 = document.createElement("u");
        balise2.innerHTML = "Synopsis :";
        bloc2.appendChild(balise2);

        let balise3 = document.createElement("p");
        balise3.innerHTML = reponse.plotLocal;
        bloc2.appendChild(balise3);

        existeSynopsis = true;
        return;
    }

    // on parse la réponse et on modifie le DOM
    function creationFiche(reponse) {

        // on supprime l'ancien contenu
        if (existeFiche) {
            var element = document.getElementById("affiche");
            while (element.firstChild) {
                element.removeChild(element.firstChild);
            }
            // existeFiche = false;
        }

        // on ajoute le contenu dans le DOM
        let bloc1 = document.getElementById("affiche");

        let balise1 = document.createElement("ul");
        balise1.id = "liste";
        bloc1.appendChild(balise1);

        let balise101 = document.createElement("li");
        balise101.innerHTML = 'Titre : ' + reponse.title;
        liste.appendChild(balise101);

        let balise102 = document.createElement("li");
        balise102.innerHTML = 'Date de sortie : ' + reponse.releaseDate;
        liste.appendChild(balise102);

        let balise103 = document.createElement("li");
        balise103.innerHTML = 'Durée : ' + reponse.runtimeStr;
        liste.appendChild(balise103);

        let balise104 = document.createElement("li");
        balise104.innerHTML = 'Genre : ' + reponse.genres;
        liste.appendChild(balise104);

        let balise105 = document.createElement("li");
        balise105.innerHTML = 'Réalisateur : ' + reponse.directors;
        liste.appendChild(balise105);

        let balise106 = document.createElement("li");
        balise106.innerHTML = 'Acteurs connus : ' + reponse.stars;
        liste.appendChild(balise106);

        existeFiche = true;
        return;
    }

</script>